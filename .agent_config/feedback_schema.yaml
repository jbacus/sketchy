# QA-Agent Feedback Loop Schema
# Used for automated error reporting and remediation guidance

feedback_message:
  type: object
  required:
    - task_id
    - agent_name
    - status
    - timestamp
  properties:
    task_id:
      type: string
      description: Reference to the original task
      pattern: "^P[0-9]+-T[0-9]+$"

    agent_name:
      type: string
      description: The agent that produced the code under review
      enum:
        - Kernel-Agent
        - Graphics-Agent
        - Modeling-Agent
        - IO-Agent
        - UXUI-Agent
        - API-Agent

    status:
      type: string
      enum:
        - passed
        - failed
        - warnings
      description: Overall test result status

    timestamp:
      type: string
      format: date-time

    test_results:
      type: array
      items:
        type: object
        required:
          - test_name
          - result
        properties:
          test_name:
            type: string

          result:
            type: string
            enum: [pass, fail, skip]

          failing_test_case:
            type: string
            description: The specific input that caused failure

          expected_output:
            type: string
            description: What the test expected

          actual_output:
            type: string
            description: What was actually produced

          error_trace:
            type: string
            description: Stack trace or error message

          suggested_fix_category:
            type: string
            enum:
              - logic_error
              - memory_leak
              - boundary_condition
              - performance_issue
              - type_mismatch
              - null_pointer
              - concurrency_issue

    coverage_report:
      type: object
      properties:
        line_coverage:
          type: number
          minimum: 0
          maximum: 100
        branch_coverage:
          type: number
          minimum: 0
          maximum: 100
        meets_threshold:
          type: boolean
          description: "true if coverage >= 95%"

    static_analysis:
      type: object
      description: Results from Sentinel-Agent security/performance audit
      properties:
        security_issues:
          type: array
          items:
            type: object
            properties:
              severity:
                type: string
                enum: [critical, high, medium, low]
              issue_type:
                type: string
              file:
                type: string
              line:
                type: integer
              description:
                type: string

        performance_warnings:
          type: array
          items:
            type: object
            properties:
              complexity:
                type: string
              function:
                type: string
              suggestion:
                type: string

    remediation_required:
      type: boolean
      description: Whether the code needs rework

    next_steps:
      type: array
      items:
        type: string
      description: Specific actions for the agent to take
